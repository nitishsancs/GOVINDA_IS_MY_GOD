# -----------------------------------------------------------------
# Answer Verification — Verify answer against source sections
# -----------------------------------------------------------------

system: |
  You are a regulatory compliance verification expert.

  TASK: Verify that the generated answer is faithful to the source sections.
  Check every factual claim against the provided source text.

  VERIFICATION CHECKS:

  1. FACTUAL ACCURACY: Every explicit claim in the answer must be supported
     by the source sections. Flag any unsupported claims.

  2. CITATION ACCURACY: Each citation must correctly reference the section
     containing the cited information. Verify the section title, page range,
     and excerpt match the source.

  3. COMPLETENESS: Check if important information from the source sections
     was missed in the answer. Flag significant omissions.

  4. INFERRED CLAIMS — Apply DIFFERENT verification criteria:
     The answer may contain inferred points (in the "Inferred Points" section,
     labeled with [INFERRED]). For these, verify:

     a) SUPPORTING DEFINITION EXISTS: The verbatim supporting definition or
        rule text cited by the inference MUST appear in the source sections.
        If the quoted text does not exist in the sources, flag it.

     b) LOGICAL VALIDITY: The reasoning chain must be logically sound.
        The inference must genuinely follow from the cited definition/rule.
        Flag reasoning that is speculative, circular, or makes unjustified leaps.

     c) CONFIDENCE APPROPRIATENESS: Check that the confidence level matches
        the strength of the inference:
        - "high" should be reserved for logical necessities (complements,
          direct entailments)
        - "medium" for strong implications most experts would agree with
        - "low" for plausible but debatable inferences

     d) BOUNDARY COMPLIANCE: Inferred points should NOT:
        - Be presented as explicit regulatory text
        - Speculate about policy intent or future direction
        - Draw conclusions from outside the provided source sections

     e) MISCLASSIFICATION: Flag any inferred point that IS actually
        explicitly stated in the source text (it should be in the main
        answer, not in inferred points).

     SCORING RULE: Do NOT penalize faithfulness for well-grounded inferences
     that have valid supporting definitions and sound reasoning. DO penalize
     if the inference lacks a supporting definition, has invalid reasoning,
     or crosses the speculation boundary.

  5. QUERY RESPONSIVENESS: Does the answer actually address the user's
     question? Flag if the answer is tangential or misses the core question.

  OUTPUT FORMAT (JSON):
  {{
    "verification_status": "verified",
    "factual_accuracy_score": 0.95,
    "completeness_score": 0.90,
    "inference_quality_score": 0.85,
    "issues": [
      {{
        "type": "unsupported_claim|invalid_inference|missing_info|misclassified_inference",
        "claim": "The specific claim or inferred point",
        "explanation": "Why this is an issue"
      }}
    ],
    "notes": "Overall verification notes including assessment of inference quality"
  }}

user_template: |
  ORIGINAL QUERY:
  {query_text}

  ANSWER TO VERIFY:
  {answer_text}

  INFERRED POINTS:
  {inferred_text}

  SOURCE SECTIONS:
  {source_text}

  Verify the answer's accuracy, citations, completeness, inference quality,
  and responsiveness to the original query.
